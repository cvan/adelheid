{% extends "base.html" %}

{% macro card(site, page, is_moment) %}
<div class="sidebar">
  <div class="main-card">
    <h1>{{ page.title }}</h1>
    <div class="blurb">{{ page.content }}</div>
    {% if is_moment %}
      <a class="moment-back">Back</a>
    {% endif %}

    <div class="moment-links">
      {% if not is_moment %}
        {% for moment in site.categories.moment|sort(attribute='weight') if moment.tag == page.slug %}
          <a class="moment-link" data-slug="{{ moment.slug }}">{{ moment.title }}</a>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>
<div class="parallax">
  <img class="key-image" src="{{ page.image }}">
</div>
{% endmacro %}

{% block extrahead %}
{% endblock %}

{% block content %}
<header>
  <nav class="bubble-nav">
    {% for chapter in site.categories.chapter|sort(attribute='chapter') %}
      <a class="bubble {{ 'active' if loop.index0 == 0 }}" style="background-image: url('{{ chapter.image }}')"></a>
    {% endfor %}
  </nav>

  <nav class="play-nav">
    <a class="prev"><i class="fa fa-backward"></i></a>
    <a class="pause"><i class="fa fa-play"></i></a>
    <a class="next"><i class="fa fa-forward"></i></a>
  </nav>
</header>

<div class="adelheid">
  {% for chapter in site.categories.chapter|sort(attribute='chapter') %}
    <section class="chapter {{ 'active' if loop.index0 == 0 }}"
             data-chapter="{{ chapter.chapter }}"
             style="z-index: {{ loop.index }}">

      <div class="flip-container">
        <div class="chapter-body front">
          {{ card(site, chapter, false) }}
        </div>
        {% for moment in site.categories.moment|sort(attribute='weight') if moment.tag == chapter.slug %}
          <div class="chapter-body moment back" data-slug="{{ moment.slug }}">
            {{ card(site, moment, true) }}
          </div>
        {% endfor %}
      </div>

      <div class="image-strip">
        <div class="image-reel">
          {% for image in chapter['images'] %}
            <img src="{{ image }}">
          {% endfor %}
        </div>
      </div>

      <audio src="{{ chapter.song }}"></audio>
    </section>
  {% endfor %}
</div>

<script src="/js/lib/angular.min.js" type="text/javascript"></script>
<script src="/js/lib/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="/js/adelheid.js" type="text/javascript"></script>
{% endblock %}
